<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/assets/css/register.css">
    <title>Register</title>
</head>
<body>
    <header>
        <div class="left-info">
            <div class="direccion">Calle Falsa 123, Ciudad, País</div>
            <div class=" telefono">+123 456 789</div>
        </div>
        <div class="right-info">
            <button>
                <% if (login) { %>                                        
                    <a href="logout" class="a-logout">Salir</a>
                <%} else { %>  
                    <a href="login" class="a-login">Iniciar Sesion</a>
                <% } %>
            </button>
        </div>
    </header>
    <main>
        <section class="input-search">
            <div class="search-info">
                <p>Estudiantes</p>
                <form id="searchForm" action="/searchList" method="post">
                    <input type="text" name="codigo" id="codigo" placeholder="Codigo/DNI">
                    <button type="button" id="scanButton">ESCANEAR</button>
                    <button type="submit">BUSCAR</button>
                </form>
            </div>
            <div class="info-list">
                <form action="/register" method="post">
                    <table>
                        <thead>
                            <tr>
                                <th></th>
                                <th>Código</th>
                                <th>DNI</th>
                                <th>Nombre y Apellidos</th>
                                <th>Estado</th>
                                <th>Carrera</th>
                            </tr>
                        </thead>
                        <tbody> 
                            <% results.forEach((user) => { %>
                            <tr>
                                <td class="check"><input type="radio" name="selectedStudent" value="<%= user.codigoestudiante %>"></td>
                                <td><%= user.codigoestudiante %></td>
                                <td><%= user.dni %></td>
                                <td><%= user.nombre %></td>
                                <td><%= user.est_beca %></td>
                                <td><%= user.nom_carrera %></td>
                            </tr>
                            <% }) %> 
                        </tbody>
                    </table>
                    <div class="button-register">
                        <button type="submit">Registrar</button>
                    </div>
                </form>
            </div>
        </section>
        <section class="info-start">
            <h1>DESAYUNO</h1>
            <h2> 48 / 120</h2>
            <P>EL REPORTE ES PARA DESCARGAR EL REPORTE DE ESTUDIANTES QUE INGRESO EN EL DESAYUNO O ALMUERZO</P>
            <button>REPORTE</button>
            <br>
            <button>INICIAR REGISTRO</button>
        </section>
    </main>

    <!-- Include HTML5 QR Code library -->
    <script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>
    <script>
        document.getElementById('scanButton').addEventListener('click', () => {
            const qrCodeReader = new Html5Qrcode("reader");
            qrCodeReader.start({ facingMode: "environment" }, { fps: 10 }, (decodedText) => {
                document.getElementById('codigo').value = decodedText;
                qrCodeReader.stop().then(() => {
                    document.getElementById('searchForm').submit();
                });
            }).catch(err => {
                console.error(err);
                alert('Error al escanear el código QR.');
            });
        });
    </script>

    <div id="reader" style="width: 100%; height: 300px;"></div>
</body>
</html>